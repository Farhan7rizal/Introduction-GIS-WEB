<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Webmap 201</title>
    <link rel="stylesheet" href="src/leaflet.css">
    <link rel="stylesheet" href="src/css/bootstrap.css">
    <link rel="stylesheet" href="src/plugins/L.Control.Pan.css">
    <link rel="stylesheet" href="src/plugins/L.Control.Zoomslider.css">
    <link rel="stylesheet" href="src/plugins/L.Control.MousePosition.css">
    <link rel="stylesheet" href="src/plugins/Leaflet.PolylineMeasure.css">
<!--    be carefull with linux because linux is case sensitive-->
    
    <script src="src/leaflet-src.js"></script>
    <script src="src/jquery-3.4.1.min.js"></script>
    <script src="src/plugins/L.Control.Pan.js"></script>
    <script src="src/plugins/L.Control.Zoomslider.js"></script>
    <script src="src/plugins/L.Control.MousePosition.js"></script>
    <script src="src/plugins/Leaflet.PolylineMeasure.js"></script>
    <style>
        #mapdiv {
            height: 735px;
            background-color: salmon;
            /*
                height: 97.9vh;
                background-color: salmon;
*/

        }

        #header {
            height: 50px;
            background-color: darkgoldenrod;
        }
    </style>
</head>

<body>
    <!--    100vh mean 100% of the viewport height   -->
    <!--
        <div id="side-bar" class="col-md-3"></div>
        <div id="mapdiv" class="col-md-9"></div>
        kebaliks
-->
    <div class="row col-md-12">
        <div id="header" class="col-md-12">
            <h1 class="text-center">Leaflet</h1>
        </div>

<!--        <div id="side-bar" >-->
<!--        using this without boostrap, to ... something in popup-->
        <div id="side-bar" class="col-md-3">
            <button id="btnLocate" class="btn btn-primary btn-block">Locate</button>
            <button id="btnZocalo" class="btn btn-primary btn-block">ZoomToZocalo</button>
            <h4> Zoom Level: <span id='zoom-level'></span></h4>
            <h4> Map Center: <span id='map-center'></span></h4>
            <h4> Mouse Location: <span id='mouse-location'></span></h4>
            <!--                add id so we can select with JQUERY and add content to it-->
        </div>
        <div id="mapdiv" class="col-md-9"></div>

    </div>


    <script>
        var mymap;
        var lyrOSM;
        var mrkCurrentLocation;
        var popZocalo;
        var popExample;
//        var ctlZoom;
        var ctlAttribute;
        var ctlScale;
        var ctlPan;
        var ctlZoomslider;
        var ctlMouseposition;
        var ctlMeasure;
        
        $(document).ready(function() {
            mymap = L.map('mapdiv', {
                center: [19.4, -99.2],
                zoom: 13, zoomControl:false,attributionControl:false
            });
            lyrOSM = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png');
            mymap.addLayer(lyrOSM);

            //                setInterval(function(){
            //                    //every 5 second is gonna call the locate methodof the map object
            //                    mymap.locate();
            //                }, 5000)
            
            ctlPan = L.control.pan({position:'bottomright'}).addTo(mymap);
            ctlZoomslider = L.control.zoomslider({position:'topright'}).addTo(mymap);
            ctlMouseposition = L.control.mousePosition().addTo(mymap);
            ctlMeasure = L.control.polylineMeasure().addTo(mymap);
            // because it is extending to the Leflet control class, and will have position options
            
            
//            ctlZoom = L.control.zoom({zoomInText:'In',zoomOutText:'Out',
//            position:'topright'});
//            ctlZoom.addTo(mymap);
            
            ctlAttribute = L.control.attribution({position:'bottomleft'}).addTo(mymap);
            ctlAttribute.addAttribution('OSM');
            ctlAttribute.addAttribution('&copy;<a href="https://www.google.com/">Link</a>');
            
            ctlScale = L.control.scale({position:'bottomleft', metric:false, maxWidth:200}).addTo(mymap);
            
            popZocalo = L.popup({maxWidth:150,keepInView:true});
            //keepInView = keep the popup in view , if you're panning it's turn again to popup
            popZocalo.setLatLng([-8.16150, 113.72644]);
            popZocalo.setContent("<h2>Zocalo</h2><img src='img/zocalo.jpg'  width='150px'>"); //set content
            
//            popExample = L.popup();
//            popExample.setLatLng([-8.16150, 113.72644]);
//            popExample.setContent($("#side-bar")[0]);
//            //when we select something in jquery it doesn't actually retrieve the DOM element it self it retrieve a specific jquery element it's actually an array of DOM elements.
//            //to get the actual DOM element itself, it is only a single one , we can use an array notation zero [0] to get actual DOM element
//            popExample.openOn(mymap);
            
            
            
            
            //add mouse event
//            mymap.on('click', function(e) {
//                //                    console.log(e);
//                //                    alert(e.latlng.toString());
//
//                //Original Event + Key   
//                //Shift key pressed                
//                if (e.originalEvent.shiftKey) {
//                    alert("Zoom Level:" + mymap.getZoom());
//                } else {
//                    alert(e.latlng.toString());
//                }
//
//            });

            //Right click pressed
            mymap.on('contextmenu', function(e) {
                var dtCurrentTime = new Date();
                L.marker(e.latlng).addTo(mymap).bindPopup(e.latlng.toString() + "<br>" + dtCurrentTime.toString());
            });

            mymap.on('keypress ', function(e) {
                //                   console.log(e); //to see an event object contain
                if (e.originalEvent.key == "l") {
                    mymap.locate(); //it calls the OS location services to find out the device locatated
                    // if it find a location it triger a location found event, if it does not find a location then it triggers a location error event
                }
            });
            // After it make another event handler
            mymap.on('locationfound', function(e) {
                console.log(e);
                if (mrkCurrentLocation) {
                    // if mrkCurrentLocation is set
                    mrkCurrentLocation.remove();
                    //remove the marker and create a new marker
                }
                //                    mrkCurrentLocation = L.circleMarker(e.latlng).addTo(mymap); //add marker to location found
                mrkCurrentLocation = L.circle(e.latlng, {
                    radius: e.accuracy / 2
                }).addTo(mymap);
                // circle have a radius, accuracy, the different is when you zoom in/out the radius will change, but circle marker is not
                // --- ACCURACY IS REPORTED BY METERS ---
                mymap.setView(e.latlng, 18);

                //To make it happen set dragging to true
            });

            //Also always handle the location error
            mymap.on('locationerror', function(e) {
                console.log(e);
                alert("location was not found");
            });

            mymap.on('zoomend', function() {
                //zoomend is gets fired continously as you're zooming ... 
                $("#zoom-level").html(mymap.getZoom());
            });

            mymap.on('moveend', function() {
                //                    $("#map-center").html(mymap.getCenter().toString());
                // convert to string (to show)
                $("#map-center").html(LatLngToArrayString(mymap.getCenter()));
            });

            mymap.on('mousemove', function(e) {
                //                    $("#mouse-location").html(e.latlng.toString()); 
                // passing the funtion and 
                $("#mouse-location").html(LatLngToArrayString(e.latlng));
            });

            $("#btnLocate").click(function() {
                mymap.locate();
            });

            $("#btnZocalo").click(function() {
                mymap.setView([-8.16150, 113.72644], 17);
                mymap.openPopup(popZocalo); 
            });

            //
        });

        function LatLngToArrayString(ll) {
            //  this funtion take a latlng object
            //to return latitude and longitude in single array
            return "[" + ll.lat.toFixed(5) + ", " + ll.lng.toFixed(5) + "]";
        }
    </script>
</body>

</html>