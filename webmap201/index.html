<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Webmap 201</title>
    <link rel="stylesheet" href="src/leaflet.css">
<!--    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">-->
    <link rel="stylesheet" href="src/css/bootstrap.css">
    <link rel="stylesheet" href="src/plugins/L.Control.Pan.css">
    <link rel="stylesheet" href="src/plugins/L.Control.Zoomslider.css">
    <link rel="stylesheet" href="src/plugins/L.Control.MousePosition.css">
    <link rel="stylesheet" href="src/plugins/L.Control.Sidebar.css">
    <link rel="stylesheet" href="src/plugins/Leaflet.PolylineMeasure.css">
    <link rel="stylesheet" href="src/plugins/easy-button.css">
    <link rel="stylesheet" href="src/plugins/leaflet-opencage/src/css/L.Control.OpenCageSearch.css">
    
    <link rel="stylesheet" href="src/bootstrap4-glyphicons/css/bootstrap-glyphicons.min.css">
<!--    be carefull with linux because linux is case sensitive-->
    
    <script src="src/leaflet-src.js"></script>
    <script src="src/jquery-3.4.1.min.js"></script>
    <script src="src/plugins/L.Control.Pan.js"></script>
    <script src="src/plugins/L.Control.Zoomslider.js"></script>
    <script src="src/plugins/L.Control.MousePosition.js"></script>
    <script src="src/plugins/L.Control.Sidebar.js"></script>
    <script src="src/plugins/Leaflet.PolylineMeasure.js"></script>
    <script src="src/plugins/easy-button.js"></script>
    <script src="src/plugins/leaflet-providers.js"></script>
    <script src="src/plugins/leaflet-opencage/src/js/L.Control.OpenCageSearch.js"></script>
    <style>
        #mapdiv {
            height: 735px;
            background-color: salmon;
            /*
                height: 97.9vh;
                background-color: salmon;
*/

        }

        #header {
            height: 50px;
            background-color: darkgoldenrod;
        }
    </style>
</head>

<body>
    <!--    100vh mean 100% of the viewport height   -->
    <!--
        <div id="side-bar" class="col-md-3"></div>
        <div id="mapdiv" class="col-md-9"></div>
        kebaliks
-->
    <div class="row col-md-12">
        <div id="header" class="col-md-12">
            <h1 class="text-center">Leaflet</h1>
        </div>

<!--        <div id="side-bar" >-->
<!--        using this without boostrap, to ... something in popup-->
        <div id="side-bar" class="col-md-12">
           
            <button id="btnLocate" class="btn btn-primary btn-block">Locate</button>
            <button id="btnZocalo" class="btn btn-primary btn-block">Zoom To Zocalo</button>
            <button id="btnGor45" class="btn btn-primary btn-block">Zoom To Gor Perjuangan 45</button>
            <button id="btnToGor45" class="btn btn-primary btn-block">Zoom To Gor Perjuangan 45 Road</button>
            <button id="btnAddGor45" class="btn btn-primary btn-block">Add Gor Perjuangan 45 To Vector Group</button>
            <button id="btnColor" class="btn btn-primary btn-block">Change Color</button>
            <h4> Zoom Level: <span id='zoom-level'></span></h4>
            <h4> Map Center: <span id='map-center'></span></h4>
            <h4> Mouse Location: <span id='mouse-location'></span></h4>
            <h4>Image Opacity: <span id='image-opacity'>0.5</span><span>: </span><input type="range" id="sldOpacity" min="0" max="1" step="0.1" value="0.5"></h4>
            
            <!--                add id so we can select with JQUERY and add content to it-->
        </div>
        <div id="mapdiv" class="col-md-12"></div>

    </div>


    <script>
        var mymap;
        var lyrOSM;
        var lyrWatercolor;
        var lyrTopo;
        var lyrImagery;
        var lyrOutdoors;
        var lyrPoltekJember;
        var lyrUnet1;
        var lyrUnet2;
        var lyrUnet3;
        var lyrUnet4;
        var mrkCurrentLocation;
        var mrkGorPerjuangan;
        var plnToPolije;
        var plyJTI;
        var fgpPolije;
        //fgp is feature group
        var popZocalo;
        var popExample;
//        var ctlZoom;
        var ctlAttribute;
        var ctlScale;
        var ctlPan;
        var ctlZoomslider;
        var ctlMouseposition;
        var ctlMeasure;
        var ctlEasybutton;
        var ctlSidebar;
        var ctlSearch;
        var ctlLayers;
        var objBasemaps;
        var objOverlays;
        
        $(document).ready(function() {
            mymap = L.map('mapdiv', {
                center: [-8.16150, 113.72644],
                zoom: 13, zoomControl:false,attributionControl:false
            });
//            lyrOSM = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png');
            lyrOSM = L.tileLayer.provider('OpenStreetMap.Mapnik');            
            lyrTopo = L.tileLayer.provider('OpenTopoMap');
            lyrImagery = L.tileLayer.provider('Esri.WorldImagery');
            lyrOutdoors = L.tileLayer.provider('Thunderforest.Outdoors');
            lyrWatercolor = L.tileLayer.provider('Stamen.Watercolor');
            
            lyrGoogle = L.tileLayer('http://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}');
            mymap.addLayer(lyrOSM);
            
            
            lyrPoltekJember = L.imageOverlay('img/PoletekRasterLayer3jadi.PNG', [[-8.154097, 113.719472],[-8.161585, 113.726757]], {opacity:0.5}).addTo(mymap);
            
            lyrUnet1 = L.imageOverlay('img/Unet1jadi.PNG', [[-8.158042, 113.714356],[-8.163717, 113.724237]]).addTo(mymap);
            lyrUnet2 = L.imageOverlay('img/Unet2jadi.PNG', [[-8.163717, 113.724237],[-8.170241, 113.714942]]).addTo(mymap);
            lyrUnet3 = L.imageOverlay('img/Unet3jadi.PNG', [[-8.170241, 113.714942],[-8.163713, 113.710393]]).addTo(mymap);
            lyrUnet4 = L.imageOverlay('img/Unet4jadi.PNG', [[-8.163713, 113.714348],[-8.161144, 113.712687]]).addTo(mymap);
            
            mrkGorPerjuangan = L.marker([-8.159631, 113.720768], {draggable:true});
            mrkGorPerjuangan.bindTooltip("Gor Perjuangan 45");
            
            
            
            plyJTI = L.polygon([[[-8.157877, 113.722245],[-8.158222, 113.723248],[-8.157448, 113.723495],[-8.157215, 113.722503]],[[-8.157417, 113.722708],[-8.157463, 113.722894],[-8.157614, 113.723264],[-8.157715, 113.723226],[-8.157563, 113.722853],[-8.157569, 113.722829],[-8.157513, 113.722668]],[[-8.156688, 113.722927],[-8.156857, 113.723469],[-8.157239, 113.723346],[-8.157059, 113.722793]]],{color:'red',fillColor:'yellow',fillOpacity:0.8});

            plnToPolije = L.polyline([[[-8.160553, 113.721017],[-8.161276, 113.723027],[-8.161722, 113.723456],[-8.163079, 113.724079],[-8.163179, 113.724173],[-8.163264, 113.725031],[-8.163285, 113.725471],[-8.163773, 113.727102],[-8.163285, 113.727242],[-8.163126, 113.726855]],[[-8.160553, 113.721017],[-8.161276, 113.723027],[-8.161722, 113.723456],[-8.163079, 113.724079],[-8.163179, 113.724173],[-8.163264, 113.725031],[-8.163285, 113.725471],[-8.162909, 113.725562],[-8.162979, 113.725943],[-8.163001, 113.726254],[-8.163126, 113.726855]],[[-8.157672, 113.722285],[-8.157815, 113.722864]]], {color:'purple'});
            //two line is an array of array
            
            //delete all layer that addTo(mymap)
            fgpPolije = L.featureGroup([plnToPolije, plyJTI]).addTo(mymap); 
            
            objBasemaps = {
                "Open Street Maps": lyrOSM,
                "Topo Map": lyrTopo,
                "Imagery": lyrImagery,
                "Outdoors":lyrOutdoors,
                "Watercolor": lyrWatercolor,
                "Google Maps": lyrGoogle
            };
            //the var must be above object overlays
            objOverlays = {
                "PoltekJember Image":lyrPoltekJember,
                "Unet1 Image":lyrUnet1,
                "Unet2 Image":lyrUnet2,
                "Unet3 Image":lyrUnet3,
                "Unet4 Image":lyrUnet4,
//                "Gor Perjuangan 45":mrkGorPerjuangan,
//                "JTI":plyJTI,
//                "Jalan bangke":plnToPolije
                "PoltekJember Vector":fgpPolije
            };
            
            ctlLayers = L.control.layers(objBasemaps, objOverlays).addTo(mymap);
            
            
            

            //                setInterval(function(){
            //                    //every 5 second is gonna call the locate methodof the map object
            //                    mymap.locate();
            //                }, 5000)
            
            ctlPan = L.control.pan({position:'bottomright'}).addTo(mymap);
            
            ctlZoomslider = L.control.zoomslider({position:'topright'}).addTo(mymap);
            
            ctlMouseposition = L.control.mousePosition().addTo(mymap);
            
            ctlMeasure = L.control.polylineMeasure().addTo(mymap);
            
            ctlSidebar = L.control.sidebar('side-bar').addTo(mymap);
            
            ctlEasybutton = L.easyButton('glyphicon-transfer', function(){
//                mymap.locate();
                ctlSidebar.toggle();
                //change col-md-.. to resize
            }).addTo(mymap);
            
            ctlSearch = L.Control.openCageSearch({key:'164e1b34050d4f7e9a0f3de89a5bda04',limit: 10}).addTo(mymap);//OSM Geocoding services
            // because it is extending to the Leflet control class, and will have position options
            
            
//            ctlZoom = L.control.zoom({zoomInText:'In',zoomOutText:'Out',
//            position:'topright'});
//            ctlZoom.addTo(mymap);
            
            ctlAttribute = L.control.attribution({position:'bottomleft'}).addTo(mymap);
            ctlAttribute.addAttribution('OSM');
            ctlAttribute.addAttribution('&copy;<a href="https://www.google.com/">Link</a>');
            
            ctlScale = L.control.scale({position:'bottomleft', metric:false, maxWidth:200}).addTo(mymap);
            
            
            
            popZocalo = L.popup({maxWidth:150,keepInView:true});
            //keepInView = keep the popup in view , if you're panning it's turn again to popup
            popZocalo.setLatLng([-8.16150, 113.72644]);
            popZocalo.setContent("<h2>Zocalo</h2><img src='img/zocalo.jpg'  width='150px'>"); //set content
            
            
            
//            popExample = L.popup();
//            popExample.setLatLng([-8.16150, 113.72644]);
//            popExample.setContent($("#side-bar")[0]);
//            //when we select something in jquery it doesn't actually retrieve the DOM element it self it retrieve a specific jquery element it's actually an array of DOM elements.
//            //to get the actual DOM element itself, it is only a single one , we can use an array notation zero [0] to get actual DOM element
//            popExample.openOn(mymap);
            
            
            
            
            //add mouse event
//            mymap.on('click', function(e) {
//                //                    console.log(e);
//                //                    alert(e.latlng.toString());
//
//                //Original Event + Key   
//                //Shift key pressed                
//                if (e.originalEvent.shiftKey) {
//                    alert("Zoom Level:" + mymap.getZoom());
//                } else {
//                    alert(e.latlng.toString());
//                }
//
//            });

            //Right click pressed
            mymap.on('contextmenu', function(e) {
                var dtCurrentTime = new Date();
                L.marker(e.latlng).addTo(mymap).bindPopup(e.latlng.toString() + "<br>" + dtCurrentTime.toString());
            });

            mymap.on('keypress', function(e) {
                //                   console.log(e); //to see an event object contain
                if (e.originalEvent.key == "l") {
                    mymap.locate(); //it calls the OS location services to find out the device locatated
                    // if it find a location it triger a location found event, if it does not find a location then it triggers a location error event
                }
            });
            // After it make another event handler
            mymap.on('locationfound', function(e) {
                console.log(e);
                if (mrkCurrentLocation) {
                    // if mrkCurrentLocation is set
                    mrkCurrentLocation.remove();
                    //remove the marker and create a new marker
                }
                //                    mrkCurrentLocation = L.circleMarker(e.latlng).addTo(mymap); //add marker to location found
                mrkCurrentLocation = L.circle(e.latlng, {
                    radius: e.accuracy / 2
                }).addTo(mymap);
                // circle have a radius, accuracy, the different is when you zoom in/out the radius will change, but circle marker is not
                // --- ACCURACY IS REPORTED BY METERS ---
                mymap.setView(e.latlng, 18);

                //To make it happen set dragging to true
            });

            //Also always handle the location error
            mymap.on('locationerror', function(e) {
                console.log(e);
                alert("location was not found");
            });

            mymap.on('zoomend', function() {
                //zoomend is gets fired continously as you're zooming ... 
                $("#zoom-level").html(mymap.getZoom());
            });

            mymap.on('moveend', function() {
                //                    $("#map-center").html(mymap.getCenter().toString());
                // convert to string (to show)
                $("#map-center").html(LatLngToArrayString(mymap.getCenter()));
            });

            mymap.on('mousemove', function(e) {
                //                    $("#mouse-location").html(e.latlng.toString()); 
                // passing the funtion and 
                $("#mouse-location").html(LatLngToArrayString(e.latlng));
            });
            
            mrkGorPerjuangan.on('dragend', function(){
                mrkGorPerjuangan.setTooltipContent("Current Location: "+mrkGorPerjuangan.getLatLng().toString()+"<br>"+"Distance to Gor Perjuangan 45: "+mrkGorPerjuangan.getLatLng().distanceTo([-8.159631, 113.720768]).toFixed(0)+" m");
            }); 

            $("#btnLocate").click(function() {
                mymap.locate();
            });

            $("#btnZocalo").click(function() {
                mymap.setView([-8.16150, 113.72644], 17);
                mymap.openPopup(popZocalo); 
            });
            
            $("#btnGor45").click(function(){
                mymap.setView([-8.159631, 113.720768]);
                mrkGorPerjuangan.setLatLng([-8.159631, 113.720768]);
                mrkGorPerjuangan.setTooltipContent("Gor 45");
            });
            
            $("#btnToGor45").click(function(){
                mymap.fitBounds(plnToPolije.getBounds());
                //zoom to the latlng bounds
            });
            
            $("#sldOpacity").on('change', function(){
                //inside function has responding to an event on #sldopacity
                $("#image-opacity").html(this.value);
                //we just returning the value of the slide, and displaying it with a span tag
                lyrPoltekJember.setOpacity(this.value);
            });
            
            $("#btnColor").on('click', function(){
                fgpPolije.setStyle({color:'purple', fillColor:'green',fillOpacity:0.8});
            });
            
            
            //add layer to fgp
            $("#btnAddGor45").click(function(){
//                fgpPolije.addLayer(mrkGorPerjuangan);
                //make it toggle
                if (fgpPolije.hasLayer(mrkGorPerjuangan)) {
                    fgpPolije.removeLayer(mrkGorPerjuangan);
                    $("#btnAddGor45").html("Add Gor 45 To Polije Vectors");
                } else {
                    fgpPolije.addLayer(mrkGorPerjuangan);
                    $("#btnAddGor45").html("Remove Gor 45 From Polije Vectors");
                }
            });

            //
        });

        function LatLngToArrayString(ll) {
            //  this funtion take a latlng object
            //to return latitude and longitude in single array
            return "[" + ll.lat.toFixed(5) + ", " + ll.lng.toFixed(5) + "]";
        }
    </script>
</body>

</html>